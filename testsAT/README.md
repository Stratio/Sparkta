# README

## ACCEPTANCE TESTS

Cucumber automated and manual acceptance tests.
This module depends on a QA library (stratio-test-bdd), where common logic and steps are implemented.

## EXECUTION

These tests will be executed as part of the continuous integration flow as follows:

mvn verify [-D\<ENV_VAR>=\<VALUE>] [-Dit.test=\<TEST_TO_EXECUTE>|-Dgroups=\<GROUP_TO_EXECUTE>]

Examples:

- Sparta Instalations:
mvn verify -DCLUSTER_ID=intbootstrap -DDCOS_SERVICE_NAME=sparta-dg -Dgroups=dcos_instalation -DlogLevel=DEBUG -DDCOS_CLI_HOST=dcos-aceptacion -DDOCKER_URL=qa.stratio.com/stratio/sparta -DCALICOENABLED=true -DHDFS_IP=10.200.0.74 -DROLE_SPARTA=open -DAUTH_ENABLED=true -DSTRATIO_SPARTA_VERSION=2.4.0-SNAPSHOT -DZK_URL=zk-0001.zkuserland.mesos:2181,zk-0002.zkuserland.mesos:2181,zk-0003.zkuserland.mesos:2181  -DCROSSDATA_SERVER_CONFIG_SPARK_IMAGE=qa.stratio.com/stratio/stratio-spark:2.2.0-2.0.0-ae1b428 -DSPARTA_JSON=spartamustache-2.4.json -DHDFS_REALM=DEMO.STRATIO.COM -DNGINX_ACTIVE=true -DMASTERS_LIST=10.200.0.242,10.200.1.64,10.200.1.41 -DPRIVATE_AGENTS_LIST=10.200.1.88,10.200.1.86,10.200.1.87,10.200.1.63,10.200.0.221 -DCLIENTSECRET=LBNuJVgfsb-WHEkP83zt -DID_SPARTA_POLICY=sparta_dg -DPOSTGRES_URL=pg-0001.postgresgov.mesos -DID_POLICY_ZK=zk1test
mvn verify -DCLUSTER_ID=nightly -DDCOS_SERVICE_NAME=sparta-server -Dgroups=dcos_instalation -DlogLevel=DEBUG -DDCOS_CLI_HOST=dcos-nightly -DDOCKER_URL=qa.stratio.com/stratio/sparta -DCALICOENABLED=true -DHDFS_IP=10.200.0.74 -DAUTH_ENABLED=true -DSTRATIO_SPARTA_VERSION=2.4.0-20896fe -DZK_URL=zk-0001.zkuserland.mesos:2181,zk-0002.zkuserland.mesos:2181,zk-0003.zkuserland.mesos:2181-DSPARTA_JSON=spartamustache-2.4.json -DNGINX_ACTIVE=true -DMASTERS_LIST=10.200.0.161,10.200.0.162,10.200.0.181,10.200.0.182,10.200.0.183,10.200.0.184,10.200.0.185,10.200.0.194 -DCLIENTSECRET=LBNuJVgfsb-WHEkP83zt -DID_SPARTA_POLICY=sparta_server -DPOSTGRES_URL=pg-0001.postgrestls.mesos -DSKIP_POLICY=false -DSTRATIO_RELEASE=ORION -DNEW_HEALTHCHECKS=false -DGOV_ENABLED=true
mvn verify -DCLUSTER_ID=fulle1 -DDCOS_SERVICE_NAME=sparta-server -DCONF_HDFS_URI=http://10.200.1.146:8085/ -Dgroups=dcos_instalation -DlogLevel=DEBUG -DDCOS_CLI_HOST=dcos-fulle1 -DDOCKER_URL=qa.stratio.com:8443/stratio/sparta -DCALICOENABLED=true -DHDFS_IP=10.200.0.74 -DROLE_SPARTA=open -DAUTH_ENABLED=true -DSTRATIO_SPARTA_VERSION=2.4.1-SNAPSHOTPR1028 -DZK_URL=zk-0001.zkuserland.mesos:2181,zk-0002.zkuserland.mesos:2181,zk-0003.zkuserland.mesos:2181  -DCROSSDATA_SERVER_CONFIG_SPARK_IMAGE=qa.stratio.com/stratio/stratio-spark:2.2.0-1.0.0 -DHDFS_REALM=DEMO.STRATIO.COM -DNGINX_ACTIVE=false -DMASTERS_LIST=10.200.1.102 -DPRIVATE_AGENTS_LIST=10.200.1.80,10.200.1.182,10.200.0.227,10.200.1.46,10.200.0.211,10.200.1.234,10.200.1.131,10.200.1.85,10.200.1.82,10.200.1.225,10.200.0.228,10.200.1.175,10.200.0.230 -DCLIENTSECRET=cr7gDH6hX2-C3SBZYWj8F -DID_POLICY_ZK=spartazk -DSKIP_POLICY=false -DPOSTGRES_NAME=postgrestls -DPOSTGRES_INSTANCE=pg-0001.postgrestls.mesos:5432/postgres -DSTRATIO_RELEASE=ORION -DNEW_HEALTHCHECKS=true -DGOV_ENABLED=false -DDYPLON_FACADE_ENABLED=true
mvn verify -DCLUSTER_ID=fulle1 -DDCOS_SERVICE_NAME=sparta-server -DMASTERS_LIST=10.200.1.102 -DSTRATIO_SPARTA_VERSION=2.1.0 -DPRIVATE_AGENTS_LIST=10.200.1.80,10.200.1.182,10.200.0.227,10.200.1.46,10.200.0.211,10.200.1.234,10.200.1.131,10.200.1.85,10.200.1.82,10.200.1.225,10.200.0.228,10.200.1.175,10.200.0.230 -DDCOS_CLI_HOST=dcos-fulle1 -Dgroups=dcos_instalation -DIDNODE=588 -DCLIENTSECRET=cr7gDH6hX2-C3SBZYWj8F -DID_POLICY_ZK=sparta_zk2 -DHDFS_REALM=PNF.STRATIO.COM -DCROSSDATA_SERVER_CONFIG_SPARK_IMAGE=qa.stratio.com/stratio/stratio-spark:2.2.0-1.0.0 -DSPARTA_JSON=spartamustache-2.1.json -DAUTH_ENABLED=true -DMARATHON_LB_TASK=marathon-lb-sec -DZK_URL=zk-0001.zkuserland.mesos:2181,zk-0002.zkuserland.mesos:2181,zk-0003.zkuserland.mesos:2181 -DNGINX_ACTIVE=true -DDOCKER_URL=qa.stratio.com/stratio/sparta -DSTRATIO_SPARTA_VERSION=2.1.0 -DCALICOENABLED=true -DCONF_HDFS_URI=http://10.200.1.146:8085/ -DID_SPARTA_POLICY=spartax -DID_KAFKA_FR_POLICY=spartakf -DID_SPARTA_POSTGRES=sparta-pg -DREGISTERSERVICEOLD=true

- Sparta Instalation with Old DCOS:
mvn verify -DCLUSTER_ID=intbootstrap -DDCOS_SERVICE_NAME=sparta-server -Dgroups=dcos_instalation -DlogLevel=DEBUG -DDCOS_CLI_HOST=dcos-aceptacion.demo.stratio.com -DDOCKER_URL=qa.stratio.com/stratio/sparta -DCALICOENABLED=true -DHDFS_IP=10.200.0.74 -DROLE_SPARTA=open -DAUTH_ENABLED=true -DSTRATIO_SPARTA_VERSION=2.2.0 -DZK_URL=zk-0001.zkuserland.mesos:2181,zk-0002.zkuserland.mesos:2181,zk-0003.zkuserland.mesos:2181  -DCROSSDATA_SERVER_CONFIG_SPARK_IMAGE=qa.stratio.com/stratio/stratio-spark:2.2.0-1.0.0 -DSPARTA_JSON=spartamustache-2.2.json -DHDFS_REALM=DEMO.STRATIO.COM -DNGINX_ACTIVE=true -DMASTERS_LIST=10.200.0.242 -DPRIVATE_AGENTS_LIST=10.200.1.88,10.200.1.86,10.200.1.87,10.200.1.63,10.200.0.221 -DCLIENTSECRET=cr7gDH6hX2-C3SBZYWj8F -DID_SPARTA_POLICY=sparta_server -DURL_GOSEC=/etc/sds/gosec-sso -DREGISTERSERVICEOLD=true -DID_POLICY_ZK=spartazk -DIDNODE=594

- Add Sparta-Policy:
 mvn verify -DCLUSTER_ID=fulle1 -DID_SPARTA_POLICY=spartapc -DSP-GOSEC-VERSION=2.4.0 -DDCOS_SERVICE_NAME=sparta-server -Dit.test=com.stratio.sparta.testsAT.automated.dcos.installations.SPARTA_1162_Gosec_AddzookeperPolicy_IT -DlogLevel=DEBUG
 mvn verify -DCLUSTER_ID=fulle1 -DID_POLICY_ZK=spartazk -DZK-GOSEC-VERSION=1.0.0 -DDCOS_SERVICE_NAME=sparta-server -Dit.test=com.stratio.sparta.testsAT.automated.dcos.installations.SPARTA_1162_Gosec_AddzookeperPolicy_IT -DlogLevel=DEBUG

- Uninstall Sparta:
mvn verify -DCLUSTER_ID=intbootstrap -DDCOS_SERVICE_NAME=sparta-server -Dgroups=dcos_uninstall -DlogLevel=DEBUG -DDCOS_CLI_HOST=dcos-aceptacion.demo.stratio.com -DDOCKER_URL=qa.stratio.com/stratio/sparta -DCALICOENABLED=true -DHDFS_IP=10.200.0.74 -DROLE_SPARTA=open -DAUTH_ENABLED=true -DSTRATIO_SPARTA_VERSION=2.2.0-3ee546d -DZK_URL=zk-0001.zkuserland.mesos:2181,zk-0002.zkuserland.mesos:2181,zk-0003.zkuserland.mesos:2181  -DCROSSDATA_SERVER_CONFIG_SPARK_IMAGE=qa.stratio.com/stratio/stratio-spark:2.2.0-1.0.0 -DSPARTA_JSON=spartamustache-2.1.json -DHDFS_REALM=DEMO.STRATIO.COM -DNGINX_ACTIVE=true -DMASTERS_LIST=10.200.0.242,10.200.1.64,10.200.1.41 -DPRIVATE_AGENTS_LIST=10.200.1.88,10.200.1.86,10.200.1.87,10.200.1.63,10.200.0.221 -DIDNODE=525 -DCLIENTSECRET=cr7gDH6hX2-C3SBZYWj8F -DID_POLICY_ZK=sparta_zk

- Khermes Instalation:
mvn verify -DMASTERS_LIST=10.200.0.242 -DPRIVATE_AGENTS_LIST=10.200.1.86  -DVAULT_PORT=8200 -DDCOS_CLI_HOST=dcos-aceptacion -Dgroups=khermes_instalation -DKHERMES_INSTANCE=khermes2

- PNF:
 mvn verify -Dit.test=com.stratio.sparta.testsAT.automated.dcos.executions.SPARTA_1196_Workflow_PNF_IT -DCLUSTER_ID='nightly' -DWORKFLOW_LIST=testinput-kafka,kafka-elastic  -DlogLevel=DEBUG -DDCOS_CLI_HOST=dcos-fulle1 -DDCOS_SERVICE_NAME=sparta-server -DSELENIUM_GRID=sl.demo.stratio.com:4444 -DFORCE_BROWSER=chrome_64sparta

- Install and execute workflows:
mvn verify -DCLUSTER_ID=fulle1 -DDCOS_SERVICE_NAME=sparta-server -Dgroups=executionswithsecurity -DlogLevel=DEBUG -DDCOS_CLI_HOST=dcos-fulle1 -DDOCKER_URL=qa.stratio.com/stratio/sparta -DCALICOENABLED=true -DHDFS_IP=10.200.0.74 -DROLE_SPARTA=open -DAUTH_ENABLED=true -DSTRATIO_SPARTA_VERSION=2.2.0 -DZK_URL=zk-0001.zkuserland.mesos:2181,zk-0002.zkuserland.mesos:2181,zk-0003.zkuserland.mesos:2181  -DCROSSDATA_SERVER_CONFIG_SPARK_IMAGE=qa.stratio.com/stratio/stratio-spark:2.2.0-1.0.0 -DHDFS_REALM=DEMO.STRATIO.COM -DNGINX_ACTIVE=false -DMASTERS_LIST=10.200.1.102 -DPRIVATE_AGENTS_LIST=10.200.1.80,10.200.1.182,10.200.0.227,10.200.1.46,10.200.0.211,10.200.1.234,10.200.1.131,10.200.1.85,10.200.1.82,10.200.1.225,10.200.0.228,10.200.1.175,10.200.0.230 -DCLIENTSECRET=cr7gDH6hX2-C3SBZYWj8F -DID_POLICY_ZK=spartazk  -DSELENIUM_GRID=sl.demo.stratio.com:4444 -DFORCE_BROWSER=chrome_64sparta -DPURGE_DATA=true -DSKIP_POLICY=false -DPOSTGRES_NAME=postgrestls -DPOSTGRES_INSTANCE=pg-0001.postgrestls.mesos:5432/postgres
mvn verify -DDCOS_SERVICE_NAME=sparta-server -DCLUSTER_ID=intbootstrap -DDCOS_SERCE_NAME=sparta-server -Dgroups=Installation_Executions_FullSecurity -DlogLevel=DEBUG -DDCOS_CLI_HOST=dcos-aceptacion.demo.stratio.com -DDOCKER_URL=qa.stratio.com/stratio/sparta -DCALICOENABLED=true -DHDFS_IP=10.200.0.74 -DROLE_SPARTA=open -DAUTH_ENABLED=true -DSTRATIO_SPARTA_VERSION=2.2.0 -DZK_URL=zk-0001.zkuserland.mesos:2181,zk-0002.zkuserland.mesos:2181,zk-0003.zkuserland.mesos:2181  -DCROSSDATA_SERVER_CONFIG_SPARK_IMAGE=qa.stratio.com/stratio/stratio-spark:2.2.0-1.0.0 -DSPARTA_JSON=spartamustache-2.2.json -DHDFS_REALM=DEMO.STRATIO.COM -DNGINX_ACTIVE=true -DMASTERS_LIST=10.200.0.242 -DPRIVATE_AGENTS_LIST=10.200.1.88,10.200.1.86,10.200.1.87,10.200.1.63,10.200.0.221 -DCLIENTSECRET=cr7gDH6hX2-C3SBZYWj8F -DID_SPARTA_POLICY=sparta_server -DURL_GOSEC=/etc/sds/gosec-sso -DREGISTERSERVICEOLD=true -DID_POLICY_ZK=spartazk -DIDNODE=594 -DSKIP_POLICY=false -DSELENIUM_GRID=sl.demo.stratio.com:4444 -DFORCE_BROWSER=chrome_64sparta -DPURGE_DATA=true -DPOSTGRES_INSTANCE=pg-0001.postgrestls.mesos:5432/postgres -DPOSTGRES_NAME=postgrestls
mvn verify -DCLUSTER_ID=nightly -DDCOS_SERVICE_NAME=sparta-server -Dgroups=dcos_instalation -DlogLevel=DEBUG -DDCOS_CLI_HOST=dcos-nightly -DDOCKER_URL=qa.stratio.com/stratio/sparta -DCALICOENABLED=true -DHDFS_IP=10.200.0.74 -DAUTH_ENABLED=true -DSTRATIO_SPARTA_VERSION=2.4.0 -DZK_URL=zk-0001.zkuserland.mesos:2181,zk-0002.zkuserland.mesos:2181,zk-0003.zkuserland.mesos:2181-DSPARTA_JSON=spartamustache-2.4.json -DNGINX_ACTIVE=true -DMASTERS_LIST=10.200.0.161,10.200.0.162,10.200.0.181,10.200.0.182,10.200.0.183,10.200.0.184,10.200.0.185,10.200.0.194 -DCLIENTSECRET=LBNuJVgfsb-WHEkP83zt -DID_SPARTA_POLICY=sparta_server -DPOSTGRES_URL=pg-0001.postgrestls.mesos -DSKIP_POLICY=false -DSTRATIO_RELEASE=ORION -DNEW_HEALTHCHECKS=false -DGOV_ENABLED=true -DSELENIUM_GRID=sl.demo.stratio.com:4444 -DFORCE_BROWSER=chrome_64sparta