<div>
  <wizard-header (onZoomIn)="changeZoom(true)" 
    [isNodeSelected]="selectedEntity && selectedEntity.length" 
    (onZoomOut)="changeZoom(false)" 
    (onCenter)="centerWorkflow()"></wizard-header>
  <div class="editor">
    <svg id="composition" class="composition" (click)="clickDetected($event)">
      <svg:g id="svg-container">

          <svg:g *ngFor="let relation of workflowRelations" wizard-segment 
          [initialEntity]="relation.origin" 
          [finalEntity]="relation.destination"></svg:g>
    
          <svg:g wizard-box svg-draggable *ngFor="let entity of entities" [data]="entity"
            [selected]="selectedEntity === entity.name"
            (onDrawConnector)="drawConnector($event)" (onFinishConnector)="finishConnector($event)"
            [(position)]="entity.position" [attr.transform]="getPosition(entity.position)"
            (onDoubleClickEvent)="editEntity(entity)" (onClickEvent)="selectEntity(entity)"/>
      </svg:g>
      <svg:filter id="drop-shadow">
          <feGaussianBlur in="SourceAlpha" stdDeviation="2.2"/>
          <feOffset dx="1" dy="4" result="offsetblur"/>
          <feFlood flood-color="rgba(0,0,0,0.5)"/>
          <feComposite in2="offsetblur" operator="in"/>
          <feMerge>
            <feMergeNode/>
            <feMergeNode in="SourceGraphic"/>
          </feMerge>
        </svg:filter>

        <svg:path [attr.d]="'M ' + connector.x1 +' ' +connector.y1 +' l ' + connector.x2 + ' ' + connector.y2" stroke="#333" *ngIf="showConnector" stroke-width="2"
        fill="none" class="connector-line"></svg:path>
    </svg>

    <sparta-sidebar [isVisible]="isShowedEntityDetails$ | async" class="wizard-sidebar" (onCloseSidebar)="closeSideBar()">
    {{svgPosition | json}}
    {{selectedEntity | json}}
    </sparta-sidebar>
  </div>
</div>
<wizard-entity-editor></wizard-entity-editor>