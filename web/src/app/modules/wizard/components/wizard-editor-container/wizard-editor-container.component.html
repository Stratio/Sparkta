<!--
    © 2017 Stratio Big Data Inc., Sucursal en España. All rights reserved.
    This software – including all its source code – contains proprietary
    information of Stratio Big Data Inc., Sucursal en España and
    may not be revealed, sold, transferred, modified, distributed or
    otherwise made available, licensed or sublicensed to third parties;
    nor reverse engineered, disassembled or decompiled, without express
    written authorization from Stratio Big Data Inc., Sucursal en España.
-->

<div #wizardModal qaTag="wizard-modal"></div>
<section [ngClass]="{'mobile' : isMobile}" [hidden]="hiddenContent">
  <wizard-header
    class="wizard-header"
    [isWorkflowDebugging]="isWorkflowDebugging"
    [selectedNodeNumber]="selectedNodeNames.length"
    [isEdgeSelected]="selectedEdge && selectedEdge.origin"
    [isPipelinesNodeSelected]="isPipelinesNodeSelected"
    [multiselectionMode]="multiselectionMode"
    [currentZoom]="editorPosition"
    [workflowData]="workflowData"
    (onZoomOut)="editorRef.changeZoom(editorPosition.k * 0.8)"
    (onZoomIn)="editorRef.changeZoom(editorPosition.k * 1.2)"
    (onCenter)="editorRef.centerWorkflow()"
    (setZoom)="editorRef.changeZoom($event)"
    (onSaveWorkflow)="saveWorkflow($event)"
    (onEditEntity)="editButtonEntity()"
    (onEditPipelinesEntity)="editButtonPipelinesEntity()"
    (deleteSelection)="deleteSelection()">
  </wizard-header>
  <div class="editor" #editorArea>
    <wizard-editor
      [workflowNodes]="workflowNodes"
      [workflowEdges]="workflowEdges"
      [creationMode]="creationMode$ | async"
      [selectedNodeNames]="selectedNodeNames"
      [editorPosition]="editorPosition"
      [multiselectionMode]="multiselectionMode"
      [multiDrag]="multiDrag "
      [disableEvents]="hiddenContent"
      [selectedEdge]="selectedEdge"
      [debugResult]="debugResult"
      [serverStepValidations]="serverStepValidations"
      [isCreatingNoteActive]="createNote$ | async"
      [nodeAnnotationsMap]="nodeAnnotationsMap$ | async"
      [edgeAnnotationsMap]="edgeAnnotationsMap$ | async"
      [draggableAnnotations]="draggableAnnotations$ | async"
      (setEditorDirty)="setEditorDirty()"
      (createNode)="createNode($event)"
      (editEntity)="editEntity($event)"
      (selectNodes)="selectNodes($event)"
      (selectNode)="selectNode($event)"
      (onCreateEdge)="createEdge($event)"
      (selectEdge)="selectEdge($event)"
      (editorPositionChange)="editorPositionChange($event)"
      (showEdgeOptions)="showEdgeOptions($event)"
      (disableSelection)="disableSelection()"
      (createAnnotation)="configAnnotation($event)"
      (disableSelection)="disableSelection()"
      (tipPositionChange)="tipPositionChange($event)"
      (showAnnotation)="showAnnotation($event)"></wizard-editor>
  </div>
  <sparta-sidebar
    showScrollBar="true"
    [darkBorder]="true"
    [isVisible]="isShowedEntityDetails$ | async"
    class="wizard-sidebar"
    (onCloseSidebar)="closeSideBar()">
    <wizard-details [entityData]="selectedNodeModel"></wizard-details>
  </sparta-sidebar>
</section>
<notification-alert *ngIf="showForbiddenError$ | async" (onClose)="hideAlert()"></notification-alert>
<edge-options *ngIf="edgeOptions.active" [edgeOptions]="edgeOptions"></edge-options>
<selected-entity *ngIf="(creationMode$ | async).active"></selected-entity>
<selected-entity *ngIf="createNote$ | async" icon="icon-plus"></selected-entity>
<wizard-annotation *ngIf="activeAnnotation"
  [annotation]="activeAnnotation"
  [position]="activeAnnotation.tipPosition"
  (activeChange)="deselectAnnotation()"
  (createMessage)="createMessage($event)"
  (changeColor)="changeColor($event)"
  (deleteAnnotation)="deleteAnnotationConfirm($event)"
  (postMessage)="postMessage($event, activeAnnotation.number)"
  class="editor__annotation"></wizard-annotation>
