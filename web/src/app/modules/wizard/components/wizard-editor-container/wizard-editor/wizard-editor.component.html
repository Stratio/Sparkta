<graph-editor
  class="editor-component"
  [editorPosition]="editorPosition"
  [creationMode]="creationMode"
  [connectorPosition]="drawingConnectionStatus.initPosition"
  [disableEvents]="disableEvents"
  (setEditorDirty)="setEditorDirty.emit()"
  (createNode)="createNode.emit($event)"
  (onClickEditor)="onClickEditor($event)"
  (editorPositionChange)="editorPositionChange.emit($event)"
  (finishSelection)="onFinishSelection($event)"
  (removeConnector)="removeConnector()">
  <svg:g wizard-edge
    *ngFor="let edge of workflowEdges; trackBy: trackBySegmentFn; let i=index;"
    [edge]="edge"
    [selectedEdge]="selectedEdge"
    [activedEdge]="selectedNodeNames.includes(edge.destination.name) || selectedNodeNames.includes(edge.origin.name)"
    [initPosition]="edge.origin.uiConfiguration.position"
    [endPosition]="edge.destination.uiConfiguration.position"
    (selectEdge)="onEdgeClick($event)"
    (showEdgeOptions)="showEdgeOptions.emit($event)">
    <ng-container *ngIf="edgeAnnotationsMap[edge.origin.name + '////' + edge.destination.name] as annotation">
      <svg:g wizard-annotation-tip
        (onMouseDown)="onShowAnnotation($event, annotation)"
        [notificationNumber]="annotation.number"
        [color]="annotation.color"
        [openOnCreate]="annotation.openOnCreate"></svg:g>
    </ng-container>
  </svg:g>
  <svg:g draggable-element *ngFor="let nodeData of workflowNodes;"
    draggableGroupName="workflow"
    [(position)]="nodeData.uiConfiguration.position"
    [selected]="selectedNodeNames.indexOf(nodeData.name) > -1"
    (onDoubleClickEvent)="editEntity.emit(nodeData)"
    (setEditorDirty)="setEditorDirty.emit()"
    (onClickEvent)="clickNode(nodeData)">
      <svg:g wizard-node
        #wnode
        [data]="nodeData"
        [attr.node-name]="nodeData.name"
        [createdNew]="nodeData.createdNew"
        [debugResult]="debugResult && debugResult[nodeData.name] ? debugResult[nodeData.name] : {}"
        [serverStepValidation]="serverStepValidations[nodeData.name]"
        [selected]="selectedNodeNames.indexOf(nodeData.name) > -1"
        [drawingConnectionStatus]="drawingConnectionStatus"
        (onDrawConnector)="createEdge($event)"
        (onFinishConnector)="finishConnector($event)">
        <ng-container>
          <svg:g wizard-annotation-tip *ngIf="nodeAnnotationsMap[nodeData.name] as annotation"
            (onMouseDown)="onShowAnnotation($event, annotation)"
            [notificationNumber]="annotation.number"
            [color]="annotation.color"
            [openOnCreate]="annotation.openOnCreate"
            transform="translate(124, -1)"></svg:g>
        </ng-container>
      </svg:g>
    </svg:g>

  <svg:g draggable-element *ngFor="let annotation of draggableAnnotations; trackBy: trackByNoteFn;"
    [position]="annotation.position"
    (onFinishPositionChange)="changeTipPosition($event, annotation.number)"
    (onClickEvent)="showEditorAnnotation($event, annotation)">
    <svg:g wizard-annotation-tip
      [notificationNumber]="annotation.number"
      [color]="annotation.color"
      [openOnCreate]="annotation.openOnCreate"
      [disableEvents]="true"
      (onMouseDown)="annotation.openOnCreate && onShowAnnotation($event, annotation)"></svg:g>
  </svg:g>
</graph-editor>
