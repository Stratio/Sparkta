<section>
   <sp-textarea-highlight class="st-form-field" [contentType]="'SQL'" label="{{'DASHBOARD.SQL_QUERY' | translate}}" required="true"
      [(ngModel)]="sqlQuery" qaTag="sql-query-textarea"></sp-textarea-highlight>
   <st-progress-bar *ngIf="isLoadingQuery$ | async" class="loading-bar"></st-progress-bar>
   <div class="execution-container">
      <button class="button button-primary" (click)="executeQuery()">
        <i class="icon-stress"></i>
        <span>Execute query</span> 
    </button>
      <span class="success" *ngIf="showResult && (!queryError || !queryError.length)">
          <span *ngIf="results.length">{{'DASHBOARD.EXECUTE_QUERY_OK' | translate:({ rows:results.length})}}</span>
      <span *ngIf="!results.length">{{'DASHBOARD.EXECUTE_QUERY_OK_NO_LIST' | translate}}</span>
      </span>
      <span class="error st-input-error-message">{{queryError}}</span>
   </div>

   <div *ngIf="!(isLoadingQuery$ | async)">
      <div class="table-container">
         <st-table [fields]="fields" qaTag="query-results" class="query-table" *ngIf="fields && fields.length" [style.width]="fields.length > 5 ? (fields.length * 220 + 'px') : '100%'">
            <tr st-table-row *ngFor="let row of results | paginate: { perPage: perPage, currentPage: currentPage }">
               <td st-table-cell st-table-row-content *ngFor="let field of row | keyobject">
                  <label>{{toString(field.value)}}</label>
               </td>
            </tr>
         </st-table>
      </div>
      <st-pagination [total]="results.length" *ngIf="results && results.length && results.length>10" [perPage]="perPage" [currentPage]="currentPage"
         [perPageOptions]="perPageOptions" (change)="changePage($event)">
      </st-pagination>
   </div>
</section>
