<!--
    © 2017 Stratio Big Data Inc., Sucursal en España. All rights reserved.
    This software – including all its source code – contains proprietary
    information of Stratio Big Data Inc., Sucursal en España and
    may not be revealed, sold, transferred, modified, distributed or
    otherwise made available, licensed or sublicensed to third parties;
    nor reverse engineered, disassembled or decompiled, without express
    written authorization from Stratio Big Data Inc., Sucursal en España.
-->
<div id="executions-managing-table-element">

  <st-table [fields]="fields"
    [sortable]="true"
    [currentOrder]="currentOrder"
    [selectableAll]="true"
    [selectedAll]="areAllSelected"
    [ngClass]="{'active-selection' : selectedExecutionsIds.length}"
    qaTag="managing-table"
    class="execution-table checkbox-table"
    (changeOrder)="onChangeOrder.emit($event)"
    (selectAll)="toggleAllExecutions($event)">
    <tr st-table-row
      [attr.id]="execution.id + '-row'"
      *ngFor="let execution of executionList | paginate: { perPage: perPage, currentPage: currentPage }; trackBy: trackByFn; let i = index;"
      [selected]="selectedExecutionsIds.indexOf(execution.id) > -1"
      (click)="checkRow(!((selectedExecutionsIds.indexOf(execution.id)) > -1), execution)">
      <td st-table-cell st-table-row-content class="check-column">
        <st-checkbox [value]="execution" [checked]="selectedExecutionsIds.indexOf(execution.id) > -1"></st-checkbox>
      </td>
      <td st-table-cell st-table-row-content>
        <label [attr.id]="execution.id + '-link'">
            <div class="execution-link" routerLink="/executions/{{execution.id}}">
              <img src="assets/images/iconStreamingExecution.svg" class="icon-row" [attr.title]="execution.executionEngine" *ngIf="execution.executionEngine === 'Streaming'"/>
              <img src="assets/images/iconBatchExecution.svg" class="icon-row" [attr.title]="execution.executionEngine" *ngIf="execution.executionEngine === 'Batch'"/>
              {{execution.name}} - v{{execution.version}}
            </div>
            <div class="execution-group">
                {{execution.group}}
            </div>
        </label>
      </td>
      <td st-table-cell st-table-row-content>
        <label class="context-field" [ngClass]="execution.context">{{execution.context || '-'}}</label>
      </td>
      <td st-table-cell st-table-row-content>
        <label>{{execution.launchDateFormatted || execution.startDateFormatted || '-'}}</label>
      </td>
      <td st-table-cell st-table-row-content>
        <label>{{execution.endDateFormatted || '-'}}</label>
      </td>
      <td st-table-cell st-table-row-content>
        <label class="status-field"><span class="oval" *ngIf="!loadingStates.includes(execution.status)" [ngClass]="execution.filterStatus"></span>
        <st-spinner class="starting-spinner" *ngIf="loadingStates.includes(execution.status)"></st-spinner>{{execution.filterStatus}}</label>
      </td>
      <td st-table-cell st-table-row-content class="execution-links">
        <div class="execution-links__container">
          <a spTitle="History server" (click)="showURI(execution.historyServerURI)" *ngIf="execution.historyServerURI && execution.historyServerURI.length"><i class="icon-history"></i></a>
          <a spTitle="Show SparkUI" (click)="showURI(execution.sparkURI)" *ngIf="execution.sparkURI && execution.sparkURI.length && execution.status === 'Started'"><i class="icon-globe"></i></a>
        </div>
      </td>
    </tr>
  </st-table>
  <div *ngIf="!executionList.length" class="empty-table">Empty results</div>
  <div *ngIf="total > 10">
    <hr />
    <div class="pagination">
        <st-pagination [total]="total"
            [perPage]="perPage"
            [perPageOptions]="perPageOptions"
            [currentPage]="currentPage"
            [id]="'execution-pagination'"
            (change)="changePage($event)"
            (changePerPage)="changePerPage($event)">
        </st-pagination>
    </div>
  </div>
</div>
