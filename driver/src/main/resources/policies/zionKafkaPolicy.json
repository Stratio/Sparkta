{
    "name": "policy-kafka",
    "duration": 10000,
    "jarPaths": [],
    "inputs": [
        {
            "name": "in",
            "elementType": "com.stratio.sparkta.plugin.input.kafka.KafkaInput",
            "configuration": {
                "topics": "zion2:1",
                "kafkaParams.zookeeper.connect" : "localhost:2181",
                "kafkaParams.group.id" : "kafka-pruebas",
                "storageLevel" : "MEMORY_AND_DISK_SER_2"
            }
        }
    ],
    "dimensions": [
        {
            "dimensionType": "com.stratio.sparkta.plugin.bucketer.passthrough.PassthroughBucketer",
            "name": "appName"
        },
        {
            "dimensionType": "com.stratio.sparkta.plugin.bucketer.passthrough.PassthroughBucketer",
            "name": "appCountry"
        },
        {
            "dimensionType": "com.stratio.sparkta.plugin.bucketer.passthrough.PassthroughBucketer",
            "name": "appPlatform"
        },
        {
            "dimensionType": "com.stratio.sparkta.plugin.bucketer.passthrough.PassthroughBucketer",
            "name": "appVersion"
        },
        {
            "dimensionType": "com.stratio.sparkta.plugin.bucketer.passthrough.PassthroughBucketer",
            "name": "device"
        },
        {
            "dimensionType": "com.stratio.sparkta.plugin.bucketer.passthrough.PassthroughBucketer",
            "name": "osVersion"
        },
        {
            "dimensionType": "com.stratio.sparkta.plugin.bucketer.passthrough.PassthroughBucketer",
            "name": "lang"
        },
        {
            "dimensionType": "com.stratio.sparkta.plugin.bucketer.passthrough.PassthroughBucketer",
            "name": "appLang"
        },
        {
            "dimensionType": "com.stratio.sparkta.plugin.bucketer.datetime.DateTimeBucketer",
            "name": "date"
        },
        {
            "dimensionType": "com.stratio.sparkta.plugin.bucketer.datetime.DateTimeBucketer",
            "name": "timestamp"
        },
        {
            "dimensionType": "com.stratio.sparkta.plugin.bucketer.passthrough.PassthroughBucketer",
            "name": "session"
        },
        {
            "dimensionType": "com.stratio.sparkta.plugin.bucketer.passthrough.PassthroughBucketer",
            "name": "extra1"
        },
        {
            "dimensionType": "com.stratio.sparkta.plugin.bucketer.passthrough.PassthroughBucketer",
            "name": "extra2"
        },
        {
            "dimensionType": "com.stratio.sparkta.plugin.bucketer.passthrough.PassthroughBucketer",
            "name": "extra3"
        },
        {
            "dimensionType": "com.stratio.sparkta.plugin.bucketer.passthrough.PassthroughBucketer",
            "name": "source"
        },
        {
            "dimensionType": "com.stratio.sparkta.plugin.bucketer.passthrough.PassthroughBucketer",
            "name": "responseTime"
        },
        {
            "dimensionType": "com.stratio.sparkta.plugin.bucketer.passthrough.PassthroughBucketer",
            "name": "environment"
        },
        {
            "dimensionType": "com.stratio.sparkta.plugin.bucketer.passthrough.PassthroughBucketer",
            "name": "platform"
        },
        {
            "dimensionType": "com.stratio.sparkta.plugin.bucketer.geohash.GeoHashBucketer",
            "name": "geo"
        }
    ],
    "rollups": [
        {
            "dimensionAndBucketTypes": [
                {
                    "dimensionName": "timestamp",
                    "bucketType": "minute"
                }
            ]
        },
        {
            "dimensionAndBucketTypes": [
                {
                    "dimensionName": "session",
                    "bucketType": "identity"
                },
                {
                    "dimensionName": "timestamp",
                    "bucketType": "minute"
                }
            ]
        },
        {
            "dimensionAndBucketTypes": [
                {
                    "dimensionName": "platform",
                    "bucketType": "identity"
                }
            ]
        },
        {
            "dimensionAndBucketTypes": [
                {
                    "dimensionName": "device",
                    "bucketType": "identity"
                }
            ]
        },
        {
            "dimensionAndBucketTypes": [
                {
                    "dimensionName": "geo",
                    "bucketType": "precision6"
                }
            ]
        },
        {
            "dimensionAndBucketTypes": [
                {
                    "dimensionName": "appPlatform",
                    "bucketType": "identity"
                },
                {
                    "dimensionName": "timestamp",
                    "bucketType": "minute"
                }
            ]
        }
    ],
    "outputs": [
        {
            "name": "out-mongo",
            "elementType": "com.stratio.sparkta.plugin.output.mongodb.MongoDbOutput",
            "configuration": {
                "clientUri": "mongodb://172.19.1.152:27017",
                "timeField": "timestamp",
                "timeDimension": "timestamp"
            }
        }
    ],
    "operators": [
        {
            "name": "count-operator",
            "elementType": "com.stratio.sparkta.plugin.operator.count.CountOperator",
            "configuration": {}
        },
        {
            "name": "max-operator",
            "elementType": "com.stratio.sparkta.plugin.operator.max.MaxOperator",
            "configuration": {
                "inputField": "responseTime"
            }
        },
        {
            "name": "min-operator",
            "elementType": "com.stratio.sparkta.plugin.operator.min.MinOperator",
            "configuration": {
                "inputField": "responseTime"
            }
        },
        {
            "name": "sum-operator",
            "elementType": "com.stratio.sparkta.plugin.operator.sum.SumOperator",
            "configuration": {
                "inputField": "responseTime"
            }
        }
    ],
    "parsers": [
        {
            "name": "morphline-parser",
            "elementType": "com.stratio.sparkta.plugin.parser.morphline.MorphlinesParser",
            "configuration": {
                "morphline": {
                    "id": "morphline1",
                    "importCommands": [
                        "org.kitesdk.**",
                        "com.stratio.ingestion.morphline.**"
                    ],
                    "commands": [
                        {
                            "readJson": {}
                        },
                        {
                            "extractJsonPaths": {
                                "paths": {
                                    "appName": "/appName",
                                    "method": "/method",
                                    "datetime": "/date",
                                    "appCountry": "/appCountry",
                                    "appPlatform": "/appPlatform",
                                    "appVersion": "/appVersion",
                                    "uid": "/uid",
                                    "device": "/device",
                                    "latitude": "/latitude",
                                    "longitude": "/longitude",
                                    "osVersion": "/osVersion",
                                    "lang": "/lang",
                                    "appLang": "/appLang",
                                    "user_id": "/user_id",
                                    "connection": "/connection",
                                    "timestamp": "/timestamp",
                                    "session": "/session",
                                    "extra1": "/extra1",
                                    "extra2": "/extra2",
                                    "extra3": "/extra3",
                                    "source": "/source",
                                    "environment": "/environment",
                                    "platform": "/platform",
                                    "responseTime": "/responseTime"
                                }
                            }
                        },
                        {
                            "addValues": {
                                "geo": "@{latitude}__@{longitude}"
                            }
                        },
                        {
                            "removeFields": {
                                "blacklist": [
                                    "literal:_attachment_body",
                                    "literal:message"
                                ]
                            }
                        }
                    ]
                }
            }
        },
        {
            "name": "timestamp",
            "elementType": "com.stratio.sparkta.plugin.parser.datetime.DateTimeParser",
            "configuration": {
                "timestamp": "unixMillis"
            }
        }
    ]
}
